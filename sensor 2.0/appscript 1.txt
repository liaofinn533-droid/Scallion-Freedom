// Apps Script Writer Code

const SHEET_NAME = "Scallion_Data"; 

function doPost(e) {
  if (!e || e.postData.type !== "application/json") {
    return ContentService.createTextOutput("Invalid Request").setMimeType(ContentService.MimeType.TEXT);
  }

  try {
    const data = JSON.parse(e.postData.contents);
    const ss = SpreadsheetApp.getActiveSpreadsheet();
    const sheet = ss.getSheetByName(SHEET_NAME);

    
    const row_data = [
      new Date().toLocaleString(),          
      data.device_id,              
      data.moisture,             
      data.temp,                 
      data.light,                
      data.pump_command || 'N/A', 
      data.health || 0             
    ];

    sheet.appendRow(row_data); 
    return ContentService.createTextOutput('{"status":"OK", "message":"Data logged"}').setMimeType(ContentService.MimeType.JSON);

  } catch (error) {
    // Log the error but return success to Function if possible
    Logger.log("Writer Script Error: " + error.toString());
    return ContentService.createTextOutput('{"status":"ERROR", "message":"Writer Script Failed"}').setMimeType(ContentService.MimeType.JSON);
  }
}